# 📝 CLI测试工具使用指南

本项目提供了三个CLI测试脚本，用于测试不同的API功能模块。所有脚本都采用交互式菜单设计，使用简单直观。

## 🚀 可用的CLI测试工具

### 1. 🤖 AI助手接口测试
**文件**: `scripts/cli_test.py`
**功能**: 测试AI助手的对话、股票分析等功能

### 2. 📊 数据更新接口测试  
**文件**: `scripts/test_data_collection.py`
**功能**: 测试股票数据采集和更新功能

### 3. ⭐ 自选股管理接口测试
**文件**: `scripts/test_watchlist.py`
**功能**: 测试自选股的增删改查功能

---

## 🔧 环境准备

### 前提条件
1. **后端服务运行**: 确保FastAPI服务在 `http://localhost:8000` 运行
2. **数据库连接**: MySQL数据库正常连接
3. **用户账户**: 确保有可用的用户账户（默认使用admin/admin123）

### 启动后端服务
```bash
# 启动Docker服务
docker-compose up -d

# 启动FastAPI应用
./start.sh
# 或
python main.py
```

---

## 📊 数据更新接口测试工具

### 启动方式
```bash
python3 scripts/test_data_collection.py
```

### 功能菜单
```
🎯 数据更新接口测试菜单
============================================================
1. 📊 采集指定股票完整数据
2. ⚡ 采集指定股票实时行情
3. 🔄 更新自选股数据（调试模式）
4. 🔍 搜索股票
5. 🎁 采集热门股票数据
6. 📈 批量采集实时行情
0. 🚪 退出
```

### 使用示例

#### 采集指定股票数据
```
选择: 1
📊 请输入要采集的股票代码: 000001,600519,300750
是否包含K线数据? (y/N): y
是否包含实时行情? (Y/n): y
是否包含基本信息? (Y/n): y

✅ 数据采集请求成功提交!
📊 采集状态: success
💬 消息: 开始采集 3 只股票的数据
```

#### 搜索股票
```
选择: 4
🔍 请输入搜索关键词: 平安银行
📝 返回结果数量限制 (默认20): 10

✅ 搜索完成! 找到 1 个结果
  1. 000001 - 平安银行
```

---

## ⭐ 自选股管理接口测试工具

### 启动方式
```bash
python3 scripts/test_watchlist.py
```

### 功能菜单
```
⭐ 自选股管理接口测试菜单
============================================================
1. 📋 查看自选股列表
2. ➕ 添加股票到自选股
3. ✏️ 更新自选股备注
4. 🗑️ 移除自选股
5. 🔍 搜索股票
6. 📊 查看个性化看板数据
7. 🎁 批量添加热门股票
8. 🧹 清空所有自选股
0. 🚪 退出
```

### 使用示例

#### 查看自选股列表
```
选择: 1
📋 正在获取自选股列表...
✅ 获取成功! 共 3 只自选股

📊 当前自选股列表:
--------------------------------------------------------------------------------
序号   股票代码       股票名称                 添加时间                 备注             
--------------------------------------------------------------------------------
1    000001     平安银行                 2025-08-04 10:30:15      银行龙头         
2    600519     贵州茅台                 2025-08-04 10:31:20      白酒之王         
3    300750     宁德时代                 2025-08-04 10:32:10      新能源电池       
```

#### 添加股票到自选股
```
选择: 2
📊 请输入股票代码: 000002
💬 请输入备注 (可选): 地产龙头

✅ 添加成功!
📊 股票代码: 000002
📝 股票名称: 万科A
💬 备注: 地产龙头
⏰ 添加时间: 2025-08-04 10:35:22
```

#### 查看个性化看板数据
```
选择: 6
📊 正在获取个性化看板数据...
✅ 获取成功!

📈 市场概览 (基于您的自选股):
  📊 关注股票总数: 4
  📈 上涨: 2 只
  📉 下跌: 1 只
  ➡️ 平盘: 1 只
  📊 上涨比例: 50.00%

💼 自选股实时行情:
------------------------------------------------------------------------------------------
股票代码     股票名称        当前价格     涨跌额    涨跌幅    成交量        
------------------------------------------------------------------------------------------
000001     平安银行          ¥12.28      +0.05    +0.41%   1,012,187    
600519     贵州茅台          ¥1417.0     -4.67    -0.33%   29,636       
300750     宁德时代          ¥263.07     -1.55    -0.59%   252,500      
000002     万科A            ¥6.39       -0.05    -0.78%   923,604      
```

---

## 🤖 AI助手接口测试工具

### 启动方式
```bash
python3 scripts/cli_test.py
```

### 功能菜单
```
🎯 请选择测试功能:
1. 💬 AI聊天测试
2. 📈 股票分析测试
3. 🌍 市场洞察测试
4. 💡 智能建议测试
5. 🤖 交互聊天模式
0. 🚪 退出
```

### 使用示例

#### AI聊天测试
```
选择: 1
💬 请输入聊天内容: 今天股市怎么样？

🤖 AI回复:
根据当前市场数据，今天A股市场表现相对平稳...
```

#### 股票分析测试
```
选择: 2
📊 请输入股票代码: 000001
📋 选择分析类型:
   1. technical - 技术分析
   2. fundamental - 基本面分析
   3. comprehensive - 综合分析
选择: 3

✅ 股票分析成功!
📊 股票: 000001 - 平安银行
📋 分析类型: comprehensive
💡 分析结果: 平安银行作为国内领先的股份制银行...
```

---

## 🛠️ 故障排除

### 常见问题

#### 1. 连接失败
```
❌ 登录失败: Connection refused
```
**解决方案**: 
- 检查后端服务是否运行在 `http://localhost:8000`
- 确认防火墙设置
- 检查服务日志

#### 2. 认证失败
```
❌ 登录失败: 401 Unauthorized
```
**解决方案**:
- 检查用户名密码是否正确（默认admin/admin123）
- 确认用户账户存在且激活
- 检查数据库连接

#### 3. 权限不足
```
❌ 操作失败: 403 权限不足
```
**解决方案**:
- 确认用户有相应权限
- 检查角色配置
- 使用管理员账户测试

#### 4. 数据采集失败
```
❌ 数据采集失败: 500 Internal Server Error
```
**解决方案**:
- 检查网络连接
- 验证东方财富API可用性
- 查看服务器日志

### 调试技巧

#### 查看详细错误信息
所有CLI工具都会显示详细的错误信息，包括状态码和错误详情。

#### 检查服务状态
```bash
# 检查服务是否运行
curl http://localhost:8000/health

# 检查API文档
open http://localhost:8000/docs
```

#### 查看日志
```bash
# 查看应用日志
tail -f logs/app.log

# 查看Docker日志
docker-compose logs -f
```

---

## 🎯 最佳实践

### 1. 测试顺序建议
1. 先运行**自选股管理测试**，确保有基础数据
2. 运行**数据更新测试**，更新股票数据
3. 最后运行**AI助手测试**，验证AI功能

### 2. 数据准备
```bash
# 快速准备测试数据
python3 scripts/test_watchlist.py
# 选择菜单 7 - 批量添加热门股票
```

### 3. 性能考虑
- 数据采集是异步操作，请等待完成
- 避免频繁的大批量数据采集
- 合理使用搜索功能的限制参数

### 4. 安全提醒
- 测试脚本硬编码了admin账户信息
- 生产环境使用时请修改认证信息
- 注意API调用频率限制

---

## 📚 相关文档

- [API设计指南](API_DESIGN_GUIDELINES.md)
- [项目结构说明](PROJECT_STRUCTURE.md)
- [开发规范](BACKEND_DEVELOPMENT_RULES.md)
- [数据采集成功案例](EASTMONEY_DATA_COLLECTION_SUCCESS.md)

---

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这些测试工具！

### 添加新功能
1. 在对应的CLI类中添加新方法
2. 在菜单中添加新选项
3. 更新本文档

### 报告问题
请在Issue中包含：
- 错误信息截图
- 操作步骤
- 环境信息
- 预期结果vs实际结果

---

*最后更新: 2025-08-04*
*版本: v1.0.0*