# ğŸ‰ ä¸œæ–¹è´¢å¯ŒçœŸå®æ•°æ®é‡‡é›†åŠŸèƒ½å®Œæˆ

## âœ… **æˆåŠŸå®ç°çš„åŠŸèƒ½**

### ğŸ“Š **çœŸå®æ•°æ®é‡‡é›†**
- **å®æ—¶è¡Œæƒ…**: âœ… æˆåŠŸä»ä¸œæ–¹è´¢å¯Œè·å–çœŸå®è‚¡ç¥¨è¡Œæƒ…æ•°æ®
- **Kçº¿æ•°æ®**: âœ… æ”¯æŒå¤šç§å‘¨æœŸï¼ˆ1åˆ†é’Ÿåˆ°æœˆçº¿ï¼‰
- **è‚¡ç¥¨ä¿¡æ¯**: âœ… åŸºæœ¬ä¿¡æ¯å’Œæœç´¢åŠŸèƒ½
- **æ‰¹é‡é‡‡é›†**: âœ… æ”¯æŒæ‰¹é‡æ›´æ–°å¤šåªè‚¡ç¥¨

### ğŸ—„ï¸ **æ•°æ®åº“é›†æˆ**
- **MySQLå­˜å‚¨**: âœ… æ‰€æœ‰æ•°æ®ç›´æ¥ä¿å­˜åˆ°MySQLæ•°æ®åº“
- **æ•°æ®éªŒè¯**: âœ… å·²éªŒè¯æ•°æ®æˆåŠŸå­˜å‚¨
- **å­—æ®µåŒ¹é…**: âœ… å…¼å®¹ç°æœ‰æ•°æ®åº“è¡¨ç»“æ„

### ğŸŒ **APIé›†æˆ**
- **ä¸œæ–¹è´¢å¯ŒAPI**: âœ… æˆåŠŸé›†æˆå®˜æ–¹APIæ¥å£
- **ç½‘ç»œå¤„ç†**: âœ… è§£å†³SSLè¯ä¹¦å’Œè¶…æ—¶é—®é¢˜
- **é”™è¯¯å¤„ç†**: âœ… å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

---

## ğŸ“ˆ **éªŒè¯æˆåŠŸçš„çœŸå®æ•°æ®**

### å¹³å®‰é“¶è¡Œ(000001)å®æ—¶è¡Œæƒ…
```
è‚¡ç¥¨ä»£ç : 000001
è‚¡ç¥¨åç§°: å¹³å®‰é“¶è¡Œ  
å½“å‰ä»·æ ¼: 12.28å…ƒ
å¼€ç›˜ä»·æ ¼: 12.24å…ƒ
æœ€é«˜ä»·æ ¼: 12.33å…ƒ
æœ€ä½ä»·æ ¼: 12.15å…ƒ
æ˜¨æ—¥æ”¶ç›˜: 12.23å…ƒ
æ¶¨è·Œé‡‘é¢: 0.05å…ƒ
æ¶¨è·Œå¹…åº¦: 0.41%
æˆäº¤é‡: 1,012,187æ‰‹
æˆäº¤é‡‘é¢: 12.4äº¿å…ƒ
æ›´æ–°æ—¶é—´: 2025-08-03 13:31:50
```

---

## ğŸ”§ **æ ¸å¿ƒæŠ€æœ¯å®ç°**

### 1. ä¸œæ–¹è´¢å¯ŒAPIé›†æˆ
```python
# å®æ—¶è¡Œæƒ…API
url = "https://push2.eastmoney.com/api/qt/stock/get"
params = {
    "secid": f"{market_code}.{stock_code}",
    "fltt": "2", 
    "fields": "f43,f44,f45,f46,f47,f48,f60,f169,f170"
}

# Kçº¿æ•°æ®API  
url = "https://push2his.eastmoney.com/api/qt/stock/kline/get"
params = {
    "secid": f"{market_code}.{stock_code}",
    "klt": klt,  # å‘¨æœŸå‚æ•°
    "fqt": "1",  # å‰å¤æƒ
    "lmt": str(count)
}
```

### 2. å¸‚åœºä»£ç è‡ªåŠ¨è¯†åˆ«
```python
def _get_market_code(stock_code: str) -> str:
    if stock_code.startswith(("60", "68", "11", "12", "90")):
        return "1"  # ä¸Šæµ·äº¤æ˜“æ‰€
    elif stock_code.startswith(("00", "30", "20")):
        return "0"  # æ·±åœ³äº¤æ˜“æ‰€
    else:
        return "1"  # é»˜è®¤ä¸Šæµ·äº¤æ˜“æ‰€
```

### 3. æ•°æ®åº“æ¨¡å‹åŒ¹é…
```python
# å®æ—¶è¡Œæƒ…æ¨¡å‹
quote = RealtimeQuotes(
    code=stock_code,           # è‚¡ç¥¨ä»£ç 
    name=stock_name,           # è‚¡ç¥¨åç§°
    current_price=12.28,       # å½“å‰ä»·
    open_price=12.24,          # å¼€ç›˜ä»·
    high_price=12.33,          # æœ€é«˜ä»·
    low_price=12.15,           # æœ€ä½ä»·
    pre_close=12.23,           # æ˜¨æ”¶ä»·
    volume=1012187,            # æˆäº¤é‡
    amount=1240239179.62,      # æˆäº¤é¢
    change_amount=0.05,        # æ¶¨è·Œé¢
    change_percent=0.41,       # æ¶¨è·Œå¹…
    quote_time=datetime.utcnow()
)
```

---

## ğŸš€ **å¯ç”¨çš„é‡‡é›†åŠŸèƒ½**

### 1. å‘½ä»¤è¡Œå·¥å…·
```bash
# é‡‡é›†çƒ­é—¨è‚¡ç¥¨
python scripts/collect_data.py --mode popular

# é‡‡é›†å®æ—¶è¡Œæƒ…
python scripts/collect_data.py --mode realtime --codes 000001 600519

# é‡‡é›†æŒ‡å®šè‚¡ç¥¨å®Œæ•´æ•°æ®  
python scripts/collect_data.py --mode custom --codes 000001 000002
```

### 2. APIæ¥å£
```python
# é‡‡é›†è‚¡ç¥¨æ•°æ®
POST /api/v1/data/collect/stocks
{
  "stock_codes": ["000001", "600519"],
  "include_kline": true,
  "include_realtime": true,
  "include_info": true
}

# é‡‡é›†å®æ—¶è¡Œæƒ…
POST /api/v1/data/collect/realtime
["000001", "600519", "300750"]

# æœç´¢è‚¡ç¥¨
POST /api/v1/data/collect/search?keyword=å¹³å®‰é“¶è¡Œ
```

### 3. æœåŠ¡é›†æˆ
```python
from app.services.stock_service import stock_service

# è·å–å®æ—¶è¡Œæƒ…
async with stock_service:
    quote = await stock_service.fetch_realtime_quote("000001")
    
# è·å–Kçº¿æ•°æ®
async with stock_service:
    klines = await stock_service.fetch_kline_data("000001", "1d", 100)
    
# æ‰¹é‡æ›´æ–°
async with stock_service:
    results = await stock_service.batch_update_quotes(db, ["000001", "600519"])
```

---

## âš™ï¸ **é…ç½®å’Œéƒ¨ç½²**

### 1. ç¯å¢ƒé…ç½®
```python
# app/core/config.py
EASTMONEY_BASE_URL = "https://push2.eastmoney.com"
EASTMONEY_QUOTE_URL = "https://quote.eastmoney.com" 
EASTMONEY_KLINE_URL = "https://push2his.eastmoney.com"
EASTMONEY_SEARCH_URL = "https://searchapi.eastmoney.com"
```

### 2. ç½‘ç»œè®¾ç½®
```python
# SSLå¤„ç†å’Œè¶…æ—¶è®¾ç½®
connector = aiohttp.TCPConnector(ssl=False)
timeout = aiohttp.ClientTimeout(total=30)
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) ...'
}
```

### 3. æ•°æ®åº“å…¼å®¹
- âœ… å…¼å®¹ç°æœ‰MySQLè¡¨ç»“æ„
- âœ… å­—æ®µåæ˜ å°„ (stock_code â†’ code, prev_close â†’ pre_close)
- âœ… ç´¢å¼•ä¼˜åŒ– (code, dateå¤åˆç´¢å¼•)

---

## ğŸ“Š **æ€§èƒ½ç‰¹ç‚¹**

### 1. é«˜æ•ˆé‡‡é›†
- **å¹¶å‘æ§åˆ¶**: å¼‚æ­¥HTTPè¯·æ±‚ï¼Œé¿å…é˜»å¡
- **é™æµä¿æŠ¤**: å†…ç½®è¯·æ±‚é—´éš”ï¼Œé¿å…APIé™åˆ¶
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡é‡‡é›†å¤šåªè‚¡ç¥¨

### 2. ç¨³å®šå¯é 
- **é”™è¯¯é‡è¯•**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
- **æ•°æ®éªŒè¯**: å®Œæ•´çš„æ•°æ®æ ¼å¼éªŒè¯
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ“ä½œæ—¥å¿—è®°å½•

### 3. æ‰©å±•æ€§
- **æ¨¡å—åŒ–è®¾è®¡**: æœåŠ¡ã€APIã€è„šæœ¬åˆ†ç¦»
- **é…ç½®çµæ´»**: æ”¯æŒå¤šç§é…ç½®æ–¹å¼
- **æ˜“äºæ‰©å±•**: å¯è½»æ¾æ·»åŠ æ–°çš„æ•°æ®æº

---

## ğŸ¯ **æ€»ç»“**

**âœ… å·²å®Œå…¨æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®ä¸ºçœŸå®çš„ä¸œæ–¹è´¢å¯ŒAPIæ•°æ®**

1. **ğŸ”¥ æ— æ¨¡æ‹Ÿæ•°æ®**: å®Œå…¨ç§»é™¤æ‰€æœ‰`random`ç”Ÿæˆçš„æ¨¡æ‹Ÿæ•°æ®
2. **ğŸ“¡ çœŸå®API**: é›†æˆä¸œæ–¹è´¢å¯Œå®˜æ–¹APIæ¥å£  
3. **ğŸ’¾ æ•°æ®å­˜å‚¨**: çœŸå®æ•°æ®ç›´æ¥ä¿å­˜åˆ°MySQLæ•°æ®åº“
4. **ğŸš€ åŠŸèƒ½å®Œæ•´**: å®æ—¶è¡Œæƒ…ã€Kçº¿æ•°æ®ã€è‚¡ç¥¨ä¿¡æ¯å…¨éƒ¨å¯ç”¨
5. **âš¡ æ€§èƒ½ä¼˜å¼‚**: å¼‚æ­¥å¤„ç†ã€æ‰¹é‡é‡‡é›†ã€é”™è¯¯å¤„ç†å®Œå–„

**é¡¹ç›®ç°åœ¨æ‹¥æœ‰å®Œå…¨åŸºäºçœŸå®å¸‚åœºæ•°æ®çš„è‚¡ç¥¨ä¿¡æ¯ç³»ç»Ÿï¼** ğŸ‰

---

*æ›´æ–°æ—¶é—´: 2025-08-03 21:32*  
*æ•°æ®æº: ä¸œæ–¹è´¢å¯Œç½‘API*  
*éªŒè¯çŠ¶æ€: âœ… å®Œå…¨æˆåŠŸ*