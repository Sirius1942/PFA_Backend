# ç§äººé‡‘èåˆ†æå¸ˆåç«¯ - æŒä¹…åŒ–åå°æœåŠ¡éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ç¡®ä¿ç§äººé‡‘èåˆ†æå¸ˆåç«¯æœåŠ¡åœ¨åå°æŒç»­è¿è¡Œï¼Œå³ä½¿SSHè¿æ¥æ–­å¼€æˆ–ç³»ç»Ÿé‡å¯ä¹Ÿä¸å—å½±å“ã€‚

## ğŸ”§ æŒä¹…åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä½¿ç”¨æŒä¹…åŒ–è„šæœ¬ (æ¨è)

**ç‰¹ç‚¹**: ä½¿ç”¨nohupç¡®ä¿è¿›ç¨‹ä¸å—SIGHUPä¿¡å·å½±å“ï¼Œå³ä½¿SSHæ–­å¼€ä¹Ÿç»§ç»­è¿è¡Œ

```bash
# å¯åŠ¨æŒä¹…åŒ–åå°æœåŠ¡
./scripts/production-daemon.sh

# åœæ­¢åå°æœåŠ¡
./scripts/stop-daemon.sh
```

### æ–¹æ¡ˆ2: ä½¿ç”¨SystemdæœåŠ¡ (æœ€ä½³)

**ç‰¹ç‚¹**: ç³»ç»Ÿçº§æœåŠ¡ç®¡ç†ï¼Œå¼€æœºè‡ªå¯åŠ¨ï¼Œè‡ªåŠ¨é‡å¯ï¼Œå®Œæ•´çš„æ—¥å¿—ç®¡ç†

```bash
# 1. å®‰è£…systemdæœåŠ¡
./scripts/install-systemd.sh

# 2. ä½¿ç”¨systemdç®¡ç†æœåŠ¡
sudo systemctl start pfa-backend     # å¯åŠ¨æœåŠ¡
sudo systemctl stop pfa-backend      # åœæ­¢æœåŠ¡
sudo systemctl restart pfa-backend   # é‡å¯æœåŠ¡
sudo systemctl status pfa-backend    # æŸ¥çœ‹çŠ¶æ€
sudo journalctl -u pfa-backend -f    # æŸ¥çœ‹æ—¥å¿—
```

## ğŸ“‹ æœåŠ¡ç®¡ç†å‘½ä»¤

### å¿«é€Ÿå‘½ä»¤

```bash
# å¯åŠ¨åå°æœåŠ¡ï¼ˆæŒä¹…åŒ–ï¼‰
./scripts/production-daemon.sh

# åœæ­¢åå°æœåŠ¡
./scripts/stop-daemon.sh

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml --env-file .env.prod ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker-compose -f docker-compose.prod.yml --env-file .env.prod logs -f

# æµ‹è¯•ç™»å½•åŠŸèƒ½
./scripts/test-production-login.sh

# ç³»ç»Ÿç›‘æ§
./scripts/monitor.sh check
```

### æ—¥å¿—æ–‡ä»¶ä½ç½®

```bash
# åå°å¯åŠ¨æ—¥å¿—
tail -f logs/docker-compose.log

# å®ˆæŠ¤è¿›ç¨‹æ—¥å¿—
tail -f logs/daemon.log

# è¿›ç¨‹IDæ–‡ä»¶
cat logs/docker-compose.pid
```

## ğŸ” éªŒè¯æœåŠ¡æŒä¹…æ€§

### æµ‹è¯•1: SSHæ–­å¼€è¿æ¥
```bash
# 1. å¯åŠ¨æœåŠ¡
./scripts/production-daemon.sh

# 2. æ–­å¼€SSHè¿æ¥
exit

# 3. é‡æ–°è¿æ¥å¹¶æ£€æŸ¥
docker ps
```

### æµ‹è¯•2: ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨
```bash
# 1. å®‰è£…systemdæœåŠ¡
./scripts/install-systemd.sh

# 2. é‡å¯ç³»ç»Ÿ
sudo reboot

# 3. æ£€æŸ¥æœåŠ¡æ˜¯å¦è‡ªåŠ¨å¯åŠ¨
sudo systemctl status pfa-backend
```

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            æŒä¹…åŒ–åå°æœåŠ¡                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   nohup     â”‚  â”‚  systemd    â”‚      â”‚
â”‚  â”‚   è¿›ç¨‹ä¿æŠ¤   â”‚  â”‚   æœåŠ¡ç®¡ç†   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         Docker Compose              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚Backend  â”‚ â”‚ MySQL   â”‚ â”‚ Redis  â”‚ â”‚â”‚
â”‚  â”‚  â”‚  :8000  â”‚ â”‚ :3307   â”‚ â”‚ :6379  â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚â”‚
â”‚  â”‚  â”‚ Nginx   â”‚                        â”‚â”‚
â”‚  â”‚  â”‚ :80/443 â”‚                        â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ é‡å¯ç­–ç•¥

### Docker Composeé‡å¯ç­–ç•¥
```yaml
restart: unless-stopped  # é™¤éæ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯
```

### Systemdé‡å¯ç­–ç•¥
```ini
Restart=on-failure  # å¤±è´¥æ—¶é‡å¯
RestartSec=10       # é‡å¯é—´éš”10ç§’
```

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/docker-compose.log
docker-compose -f docker-compose.prod.yml --env-file .env.prod logs backend
```

### é—®é¢˜2: æƒé™é—®é¢˜
```bash
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x scripts/*.sh
```

### é—®é¢˜3: ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "(8000|3307|6379|80|443)"
```

### é—®é¢˜4: è¿›ç¨‹ä¸¢å¤±
```bash
# æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨
ps aux | grep docker-compose
cat logs/docker-compose.pid
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. èµ„æºé™åˆ¶
```yaml
# åœ¨docker-compose.prod.ymlä¸­è®¾ç½®
services:
  backend:
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
```

### 2. æ—¥å¿—è½®è½¬
```bash
# é…ç½®Dockeræ—¥å¿—è½®è½¬
# /etc/docker/daemon.json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m",
    "max-file": "3"
  }
}
```

## ğŸ“± ç›‘æ§å’Œå‘Šè­¦

### ç³»ç»Ÿç›‘æ§
```bash
# å®æ—¶ç›‘æ§
./scripts/monitor.sh watch

# ç”ŸæˆæŠ¥å‘Š
./scripts/monitor.sh report
```

### å¥åº·æ£€æŸ¥
```bash
# APIå¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# ç™»å½•åŠŸèƒ½æ£€æŸ¥
./scripts/test-production-login.sh
```

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] é‡å¯ç­–ç•¥å·²é…ç½®
- [ ] æŒä¹…åŒ–è„šæœ¬å¯æ‰§è¡Œ
- [ ] æ—¥å¿—æ–‡ä»¶å¯è®¿é—®
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] SystemdæœåŠ¡å·²å®‰è£…ï¼ˆå¯é€‰ï¼‰
- [ ] å¼€æœºè‡ªå¯åŠ¨å·²å¯ç”¨ï¼ˆå¯é€‰ï¼‰
- [ ] ç›‘æ§è„šæœ¬æ­£å¸¸å·¥ä½œ

---

## ğŸ‰ æ€»ç»“

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæ‚¨çš„ç§äººé‡‘èåˆ†æå¸ˆåç«¯æœåŠ¡ç°åœ¨å¯ä»¥ï¼š

- âœ… åœ¨åå°æŒç»­è¿è¡Œ
- âœ… ä¸å—SSHè¿æ¥æ–­å¼€å½±å“
- âœ… ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨
- âœ… æœåŠ¡å¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•
- âœ… ä¾¿æ·çš„ç®¡ç†å‘½ä»¤

**æ¨èä½¿ç”¨æ–¹æ¡ˆ**: 
1. æ—¥å¸¸ä½¿ç”¨: `./scripts/production-daemon.sh`
2. ç”Ÿäº§ç¯å¢ƒ: å®‰è£…systemdæœåŠ¡å®ç°å®Œå…¨è‡ªåŠ¨åŒ–ç®¡ç† 